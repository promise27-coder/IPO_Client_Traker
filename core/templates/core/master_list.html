{% extends 'core/base.html' %}

{% block content %}
<style>
    /* Spreadsheet Look for Master List */
    .sheet-input { background: transparent; border: none; width: 100%; color: white; padding: 8px; outline: none; }
    .sheet-input:focus { background: #374151; border-radius: 4px; }
    td { border-bottom: 1px solid #374151; }
</style>

<div class="flex gap-6 flex-col md:flex-row">
    
    <div class="w-full md:w-2/3">
        <h2 class="text-2xl font-bold mb-4 text-purple-400">ðŸ‘¥ Master Client List </h2>
        
        <div class="bg-gray-800 rounded shadow border border-gray-700 overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-gray-900 text-gray-300 uppercase text-xs">
                    <tr>
                        <th class="p-3 w-1/3">Nickname</th>
                        <th class="p-3 w-1/3">Broker</th>
                        <th class="p-3 w-1/3">PAN Number</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700 text-gray-300">
                    {% for m in masters %}
                    <tr class="hover:bg-gray-750 transition">
                        <td class="p-0">
                            <input type="text" value="{{ m.nickname }}" class="sheet-input font-bold text-white" 
                                   onchange="saveMasterData({{ m.id }}, 'nickname', this.value)">
                        </td>
                        
                        <td class="p-0">
                            <input type="text" value="{{ m.broker }}" class="sheet-input text-gray-300" 
                                   onchange="saveMasterData({{ m.id }}, 'broker', this.value)">
                        </td>
                        
                        <td class="p-0">
                            <input type="text" value="{{ m.pan_number }}" class="sheet-input text-gray-400 uppercase" 
                                   onchange="saveMasterData({{ m.id }}, 'pan_number', this.value)">
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3" class="p-10 text-center text-gray-500">Haji koi data nathi. Bajuma form thi add karo! ðŸ‘‰</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <a href="/" class="inline-block mt-4 text-gray-400 hover:text-white transition">&larr; Back to Dashboard</a>
    </div>

    <div class="w-full md:w-1/3 bg-gray-800 p-6 rounded h-fit border border-gray-700 shadow-lg">
        <h3 class="text-xl font-bold mb-4 text-white border-b border-gray-600 pb-2">âž• Add New Person</h3>
        <form method="POST">
            {% csrf_token %}
            {% for field in form %}
            <div class="mb-4">
                <label class="block text-gray-400 text-xs uppercase font-bold mb-1">{{ field.label }}</label>
                <div class="text-black">{{ field }}</div>
            </div>
            {% endfor %}
            <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded font-bold mt-2 shadow transition">
                Save to Master List
            </button>
        </form>
        <script>
            document.querySelectorAll('.w-full.md\\:w-1\\/3 input').forEach(el => {
                el.className = 'w-full bg-gray-700 border border-gray-600 rounded p-2 text-white focus:outline-none focus:border-purple-500';
            });
        </script>
    </div>
</div>

<script>
    function saveMasterData(id, field, value) {
        // Console log to check if working
        console.log(`Saving Master ${id}: ${field} = ${value}`);

        fetch(`/update-master/${id}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                'field': field,
                'value': value
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Success visual (Optional: Green flash)
            } else {
                alert("Error saving data!");
            }
        })
        .catch(error => console.error('Error:', error));
    }
</script>
{% endblock %}